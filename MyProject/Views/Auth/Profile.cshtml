@using MyProject.Models
@model MyProject.Models.User

<link rel="stylesheet" href="~/css/profile.css" />
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <!-- Profile Header -->
            <div class="profile-header">
                <img src="@(Model.ProfilePhoto ?? "https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg")"
                     alt="Profile Picture" class="profile-picture">
                <div class="profile-info">
                    <div class="profile-text">
                        <div class="profile-name">@Model.FirstName @Model.LastName</div>
                        <div class="profile-email">@Model.EmailId</div>
                        <div class="profile-meta">
                            Member since @Model.TimeStamp.ToString("MMMM yyyy") |
                            @(Model.Providers ?? "Local")
                        </div>
                    </div>
                    <div class="quote-action-container">
                        <div class="profile-quote-container" id="quoteContainer">
                            <!-- Quotes will be inserted by JavaScript -->
                        </div>
                        <button class="menu-redirect-btn" id="menuRedirectBtn">
                            Order Now <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'Tab1')" id="defaultOpen">Edit Profile</button>
                <button class="tablinks" onclick="openTab(event, 'Tab2')">My Bookings</button>
                <button class="tablinks" onclick="openTab(event, 'Tab3')">My Orders</button>
                <button type="button" class="tablinks logout-btn" onclick="showLogoutModal()">Logout</button>
            </div>

            <!-- Logout Confirmation Modal -->
            <div id="logoutModal" class="modal-overlay" style="display:none;">
                <div class="modal-content">
                    <p>Are you sure you want to logout?</p>
                    <form method="post" action="/Auth/Logout" id="logoutForm">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-danger">Yes</button>
                        <button type="button" class="btn btn-secondary" onclick="hideLogoutModal()">Cancel</button>
                    </form>
                </div>
            </div>

            <!-- Tab Content -->
            <div id="Tab1" class="tabcontent">
                <h3>Profile Information</h3>
                <p>Your profile details will appear here.</p>
            </div>

            <div id="Tab2" class="tabcontent">
                <h3 class="booking-title">My Bookings</h3>
                @if (ViewBag.Bookings == null || ((List<Booking>)ViewBag.Bookings).Count == 0)
                {
                    <p class="no-bookings">No bookings found.</p>
                }
                else
                {
                    <div class="card-grid">
                        @foreach (var booking in (List<Booking>)ViewBag.Bookings)
                        {
                            <div class="card">
                                <img src="@(
                                    booking.NoOfPerson == 2 ?
                                    "https://www.gharnish.com/cdn/shop/files/Heera2seaterrestaurantdiningsetImportersInIndia.jpg?v=1710355669" :
                                    booking.NoOfPerson == 3 ?
                                    "https://i.pinimg.com/474x/bc/1f/55/bc1f55b526099619330d7eb232439d1b.jpg" :
                                    booking.NoOfPerson == 4 ?
                                    "https://image.made-in-china.com/2f0j00WjDlyiJcrvzt/Nordic-Plastic-Wood-Outdoor-Table-and-Chairs-Cafe-Restaurant-Outdoor-One-Table-and-4-Chairs.webp" :
                                    "https://www.homesrus.ae/media/catalog/product/5/1/5121200102358_l.jpg?quality=80&bg-color=255,255,255&fit=bounds&height=840&width=840&canvas=840:840"
                                )" alt="Booking Image" />

                                <h2>@booking.Name</h2>
                                <p class="title">@booking.Mail</p>
                                <p><i class="fa fa-phone"></i> @booking.Phone</p>
                                <p><i class="fa fa-calendar"></i> @booking.DateTime.ToString("f")</p>
                                <p><strong>Guests:</strong> @booking.NoOfPerson</p>
                                <p><strong>Message:</strong> @booking.Message</p>

                                <div class="social-icons">
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                    <a href="#"><i class="fa fa-linkedin"></i></a>
                                    <a href="#"><i class="fa fa-envelope"></i></a>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

            <div id="Tab3" class="tabcontent">
                <h3 class="orders-title">My Orders</h3>
                @if (ViewBag.Orders == null || ((List<Order>)ViewBag.Orders).Count == 0)
                {
                    <p class="no-orders">No orders found.</p>
                }
                else
                {
                    foreach (var order in (List<Order>)ViewBag.Orders)
                    {
                        <div class="order-container">
                            <p style="font-size:30px;"><strong> #@order.OrderId </strong></p>
                            <p><strong>Date:</strong> @order.OrderDate.ToString("f")</p>
                            <p><strong>Total:</strong> ₹@order.TotalAmount</p>
                            <p style="color:burlywood;"><strong style="color:white;">Status:</strong> @order.Status</p>

                            <ul class="order-items">
                                @foreach (var item in order.OrderItems)
                                {
                                    <li class="order-item">
                                        <img src="@Url.Content("~/images/" + (string.IsNullOrEmpty(item.Product?.Image) ? "default.png" : item.Product.Image))"
                                             alt="Product Image" />
                                        <div class="order-item-details">
                                            <div><strong>Product:</strong> @Html.DisplayFor(modelItem => item.Product.ProductName)</div>
                                            <div><strong>Qty:</strong> @item.Quantity</div>
                                            <div><strong>Price:</strong> ₹@item.Price</div>
                                        </div>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>

<!-- Optional: Modal CSS -->

<!-- JavaScript for Tab + Logout Modal -->
<script>
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
    }

    document.getElementById("defaultOpen").click();

    function showLogoutModal() {
        document.getElementById("logoutModal").style.display = "flex";
    }

    function hideLogoutModal() {
        document.getElementById("logoutModal").style.display = "none";
    }
</script>
